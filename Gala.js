const Discord=require("discord.js"),client=new Discord.Client,settings=require("./settings.json"),fs=require("fs"),readline=require("readline"),colors={sucess:65280,neutral:2061822,error:16711680,custom:0};let activity=0;function message(){const e=readline.createInterface({input:process.stdin,output:process.stdout});e.question("",t=>{client.channels.find(e=>"general"===e.name).send(t),e.close(),console.log("Sent"),message()})}client.on("ready",()=>{const e=client.channels.find(e=>"general"===e.name);functions.botWrite(e,"neutral","Bot ready!",client),setInterval(function(){let e=[`with ${client.users.size} users on ${client.guilds.size} servers.`,'Try "'+settings.prefix+'"'];activity>=e.length&&(activity=0),client.user.setActivity(e[activity]),activity++},5e3)}),client.on("message",e=>{logger.run(e),e.content=e.content.toLowerCase().split(" "),e.content[0]==settings.prefix&&(commandCheck.run(e,client),e.delete(0))}),message(),exports.commandCheck={run:function(e,t){let n=!1;function o(n,s){let r="./Commands";for(let e=0;e<n.length;e++)r+="/"+n[e];const i=require(r+"/main.js");if(i.parameter)for(let c=0;c<i.parameter.length;c++)if("command"==i.parameter[c].type)fs.readdir(r,function(a,l){if(a&&console.log("error",a),l=l.filter(function(e){return"main.js"!=e}),e.content[s+c]&&""!=e.content[s+c])for(let t=0;t<l.length;t++)l[t]==e.content[s+c]?(n.push(l[t]),o(n,s+1),t=l.length):t+1==l.length&&(functions.write(e,"error","Subcommand not found, please use `"+settings.prefix+" "+r.replace("./Commands/"+n[0]+"/","").replace("/"," ")+"` for commands."),t=i.parameter.length);else{let o=[],s="";0!==n.length&&(o=[{name:"Back",emoji:"⬅"}],s="⬅ **Back**\n\n");for(let e=0;e<l.length;e++){const t=require(r+"/"+l[e]+"/main.js");o.push({name:l[e],emoji:t.emoji}),s+=t.emoji+" **"+l[e]+"**\n`"+t.about+"`\n\n"}o.push({name:"Exit",emoji:"❌"}),s+="❌ **Exit**",functions.reactWrite(e,"sucess",s,o,n,t)}});else if("hex"==i.parameter[c].type)if(e.content[s+c]&&""!=e.content[s+c]){const n=/[0-9A-Fa-f]{6}/g;e.content[s+c]=e.content[s+c].replace("#",""),n.test(e.content[s+c])&&6==e.content[s+c].length?i.run(e,t):(functions.write(e,"error","Invalid hex code."),a=i.parameter.length)}else functions.colorWrite(e,"sucess",i.parameter[c].text,t);else if("mention"==i.parameter[c].type)if(e.content[s+c]&&""!=e.content[s+c]){e.content[s+c].startsWith("<@")&&e.content[s+c].endsWith(">")&&(e.content[s+c]=e.content[s+c].slice(2,-1),e.content[s+c].startsWith("!")&&(e.content[s+c]=e.content[s+c].slice(1))),void 0!==t.users.get(e.content[s+c])?c+1==i.parameter.length&&i.run(e,t):(functions.write(e,"error","Person not found."),c=i.parameter.length)}else functions.waitWrite(e,"sucess",i.parameter[c].text,t);else"number"==i.parameter[c].type&&(e.content[s+c]&&""!=e.content[s+c]||functions.waitWrite(e,"sucess",i.parameter[c].text,t));else i.run(e,t)}e.content[1]?fs.readdir("./Commands",function(t,s){function r(){for(let t=0;t<s.length;t++)fs.readdir("./Commands/"+s[t],function(r,i){for(let r=0;r<i.length;r++)e.content[1]==i[r].toLowerCase()?("Admin"==s[t]?e.member.roles.some(e=>data.adminRoles.includes(e.name))?o([s[t],i[r]],2):functions.write(e,"error","You need the permission(s) `"+command.permissions().join(", ")+"` to use the command `"+e.content[1]+"."):o([s[t],i[r]],2),t=s.length,r=i.length,n=!0):t+1!=s.length||r+1!=i.length||n||functions.write(e,"error","Command not found, please use `"+settings.prefix+"` for commands.")})}s=s.filter(function(e){return"main.js"!=e});for(let t=0;t<s.length;t++)e.content[1]==s[t].toLowerCase()?(e.content[2]?r():o([s[t]],2),e.content=e.content.filter(function(t){return t!=e.content[1]}),t=s.length):t+1==s.length&&r()}):o([],1)}},exports.functions={botWrite:function(e,t,n,o){const s=(new Discord.RichEmbed).setColor(colors[t]).setTitle(n).setAuthor(o.user.username,o.user.avatarURL).setTimestamp();e.send(s)},write:function(e,t,n,o){function s(){if("error"!=t)for(let n=0;n<o.users.length;n++)o.users[n].id==e.author.id&&null!=o.users[n].color&&(colors.custom=o.users[n].color,t="custom");!function(){const o=(new Discord.RichEmbed).setColor(colors[t]).setTitle(n).setAuthor(e.author.username,e.author.avatarURL).setTimestamp();e.channel.send(o)}()}o?s():fs.readFile("./data.json","utf8",function(e,t){o=JSON.parse(t),s()})},reactWrite:async(e,t,n,o,s,r,i)=>{function a(){if("error"!=t)for(let n=0;n<i.users.length;n++)i.users[n].id==e.author.id&&null!=i.users[n].color&&(colors.custom=i.users[n].color,t="custom");!async function(){let s=!1;const i=(new Discord.RichEmbed).setColor(colors[t]).setTitle(n).setAuthor(e.author.username,e.author.avatarURL).setTimestamp();let a=[];for(let e=0;e<o.length;e++)a.push(o[e].emoji);e.channel.send(i).then(async t=>{for(let e=0;e<a.length;e++)await t.react(o[e].emoji);await t.awaitReactions((n,i)=>{for(let a=0;a<o.length;a++)n.emoji.name!==o[a].emoji||i.id!=e.author.id||s||("Exit"!=o[a].name&&("Back"==o[a].name?e.content.pop():e.content.push(o[a].name.toLowerCase()),commandCheck.run(e,r)),t.delete(),s=!0)},{time:12e4})})}()}i?a():fs.readFile("./data.json","utf8",function(e,t){i=JSON.parse(t),a()})},waitWrite:async(e,t,n,o,s)=>{function r(){if("error"!=t)for(let n=0;n<s.users.length;n++)s.users[n].id==e.author.id&&null!=s.users[n].color&&(colors.custom=s.users[n].color,t="custom");!async function(){let s=!1;const r=(new Discord.RichEmbed).setColor(colors[t]).setTitle(n).setAuthor(e.author.username,e.author.avatarURL).setTimestamp();e.channel.send(r).then(async t=>{await e.channel.awaitMessages(n=>{n.author.id!=e.author.id||s||(e.content.push(n.content[0]),commandCheck.run(e,o),t.delete(),s=!0)},{time:12e4})})}()}s?r():fs.readFile("./data.json","utf8",function(e,t){s=JSON.parse(t),r()})},colorWrite:async(e,t,n,o,s)=>{function r(){if("error"!=t)for(let n=0;n<s.users.length;n++)s.users[n].id==e.author.id&&null!=s.users[n].color&&(colors.custom=s.users[n].color,t="custom");!async function(){let s=!1;const r=(new Discord.RichEmbed).setColor(colors[t]).setTitle(n).setAuthor(e.author.username,e.author.avatarURL).setTimestamp();let i=[];for(let e=0;e<items.length;e++)i.push(items[e].emoji);e.channel.send(r).then(async t=>{for(let e=0;e<i.length;e++)await t.react(items[e].emoji);await t.awaitReactions((n,r)=>{for(let i=0;i<items.length;i++)n.emoji.name!==items[i].emoji||r.id!=e.author.id||s||("Exit"!=items[i].name&&("Back"==items[i].name?e.content.pop():e.content.push(items[i].value.toLowerCase()),commandCheck.run(e,o)),t.delete(),s=!0)},{time:12e5})}),await e.channel.awaitMessages(t=>{t.author.id!=e.author.id||s||(e.content.push(t.content[0]),commandCheck.run(e,o),s=!0)},{time:12e4})}()}items=[{name:"Back",emoji:"⬅"},{name:"Black",emoji:"⬛",value:"000000"},{name:"White",emoji:"⚪",value:"FFFFFF"},{name:"Orange",emoji:"🔶",value:"FFA500"},{name:"Red",emoji:"♦",value:"FF0000"},{name:"Orange",emoji:"🔹",value:"1589FF"}],s?r():fs.readFile("./data.json","utf8",function(e,t){s=JSON.parse(t),r()})}};const logger={run:function(e){var t=new Date(e.timestamp);console.log(t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear()+" "+e.author.username+": "+e.content)}};client.login(process.env.BOT_TOKEN);
